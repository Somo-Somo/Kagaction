<template>
    <g id="Circle Grapth">
        <g id="Condition Grapth">
            <circle
                v-for="condition in conditionPieCharts[$route.params.id]"
                :key="condition.strokeDashArray"
                cx="332"
                cy="384"
                r="140"
                stroke-width="280"
                stroke-dashoffset="220"
                :stroke-dasharray="condition.strokeDashArray"
                :stroke="condition.color"
            />
        </g>
        <g id="Feeling Grapth">
            <circle
                v-for="feeling in feelingPieCharts[$route.params.id]"
                :key="feeling.strokeDashArray"
                cx="327"
                cy="384"
                r="90"
                stroke-width="180"
                stroke-dashoffset="140"
                :stroke-dasharray="feeling.strokeDashArray"
                :stroke="feeling.color"
            />
        </g>
        <g id="Center">
            <circle id="Ellipse 13_2" cx="327" cy="384" r="80" fill="white" />
            <g id="Hart">
                <path
                    id="Vector"
                    d="M295.597 355.952C297.245 353.806 299.663 352.604 302.003 351.4C303.69 350.532 305.593 350.101 307.623 350.014C310.814 349.878 313.63 350.718 316.104 352.403C317.609 353.428 318.939 354.719 320.148 356.041C321.222 357.22 322.084 358.573 322.929 359.909C324.211 361.937 325.135 364.109 325.748 366.389C326.348 368.625 326.854 370.873 326.933 373.185C326.936 373.284 327.024 373.383 327.073 373.482C327.193 373.367 327.399 373.263 327.421 373.136C327.713 371.342 328.502 369.704 329.241 368.044C330.009 366.314 330.987 364.696 332.301 363.275C333.496 361.984 334.743 360.726 336.058 359.537C337.89 357.877 339.718 356.196 341.712 354.705C343.751 353.181 346.099 352.1 348.722 351.596C352.756 350.82 356.532 351.156 359.585 353.963C361.358 355.592 362.353 357.655 362.672 359.945C362.85 361.23 363.046 362.535 362.99 363.821C362.898 366.01 362.407 368.153 361.75 370.272C360.773 373.425 359.254 376.361 357.756 379.317C356.512 381.77 355.458 384.302 354.235 386.764C353.481 388.281 352.578 389.734 351.717 391.204C350.891 392.614 350.077 394.032 349.182 395.404C347.272 398.334 345.319 401.239 343.373 404.147C340.877 407.876 338.398 411.617 335.842 415.313C335.237 416.188 334.431 416.975 333.588 417.672C332.865 418.27 332.035 417.998 331.401 417.279C330.86 416.665 330.196 416.143 329.576 415.589C327.157 413.425 324.652 411.337 322.343 409.082C320.688 407.466 319.256 405.653 317.796 403.879C316.555 402.372 314.975 401.214 313.401 400.041C312.039 399.029 310.663 398.032 309.28 397.045C306.253 394.886 303.388 392.564 300.752 390.012C298.74 388.063 297.056 385.891 295.542 383.592C293.762 380.89 292.592 377.969 291.717 374.95C291.369 373.748 291.315 372.471 291.178 371.223C291.077 370.299 290.949 369.359 291.021 368.44C291.244 365.582 291.758 362.772 293.179 360.171C293.945 358.767 294.762 357.382 295.597 355.952ZM343.034 358.378C341.517 358.95 340.051 359.589 339.015 360.82C337.522 362.591 335.884 364.277 334.582 366.159C333.009 368.433 331.672 370.849 330.326 373.248C329.104 375.429 328.87 377.864 328.461 380.24C328.255 381.442 328.244 382.671 328.101 383.884C327.965 385.023 326.868 385.615 326.114 384.934C325.813 384.663 325.863 384.071 325.743 383.627C325.705 383.478 325.637 383.336 325.583 383.192C325.469 383.311 325.315 383.416 325.248 383.555C324.951 384.162 324.708 384.791 324.388 385.386C324.132 385.861 323.152 386.197 322.77 385.916C322.304 385.573 321.803 385.222 322.186 384.488C322.81 383.29 323.335 382.047 323.871 380.813C324.118 380.243 324.366 379.712 324.008 379.026C323.08 377.251 322.256 375.429 321.426 373.612C320.065 370.644 318.253 367.92 316.106 365.383C315.009 364.085 313.818 362.854 312.658 361.601C310.419 359.187 307.931 357.052 304.659 355.845C303.387 355.373 302.069 355.036 300.678 355.452C299.404 355.832 298.709 356.833 297.943 357.708C297.415 358.309 297.018 359.054 296.761 359.792C296.35 360.973 296.098 362.188 296.381 363.462C296.59 364.401 296.521 365.397 296.772 366.323C297.481 368.941 298.541 371.452 299.921 373.832C301.339 376.28 302.8 378.709 304.341 381.095C306.024 383.703 307.772 386.278 309.577 388.818C311.61 391.68 313.719 394.499 315.832 397.313C316.652 398.404 317.46 399.533 318.477 400.457C319.556 401.437 320.848 402.228 322.098 403.038C324.24 404.428 326.388 405.816 328.596 407.116C330.267 408.099 332.035 408.944 333.759 409.854C334.253 410.116 334.627 410.152 334.925 409.576C335.216 409.015 335.634 408.51 335.982 407.973C337.352 405.847 338.715 403.718 340.083 401.59C341.279 399.732 342.454 397.862 343.677 396.02C345.044 393.964 346.48 391.947 347.838 389.888C349.572 387.263 351.171 384.558 352.993 381.984C355.587 378.317 356.535 374.231 356.92 369.994C357.049 368.566 356.895 367.107 356.765 365.67C356.625 364.127 356.201 362.653 355.272 361.309C353.49 358.735 350.943 357.305 347.64 357.353C346.127 357.374 344.625 357.968 343.034 358.378ZM324.312 371.941C323.937 370.209 323.723 368.431 323.141 366.76C322.473 364.848 321.604 362.971 320.596 361.187C318.899 358.182 316.654 355.567 313.398 353.799C310.91 352.446 308.272 352.081 305.475 352.791C305.192 352.862 304.933 353.015 304.664 353.13C304.935 353.236 305.205 353.341 305.476 353.448C305.547 353.476 305.615 353.512 305.689 353.535C308.1 354.303 310.106 355.682 311.905 357.26C313.65 358.791 315.21 360.501 316.811 362.167C319.202 364.654 321.021 367.493 322.698 370.407C323.275 371.413 323.697 372.491 324.209 373.529C324.265 373.643 324.449 373.704 324.574 373.79C324.614 373.65 324.706 373.502 324.685 373.369C324.611 372.915 324.495 372.467 324.312 371.941ZM294.122 366.701C293.98 367.028 293.722 367.356 293.722 367.683C293.72 368.739 293.805 369.796 293.871 370.852C293.911 371.473 293.897 372.11 294.053 372.709C294.554 374.634 295.047 376.549 295.854 378.413C297.439 382.074 299.751 385.281 302.627 388.158C304.053 389.584 305.647 390.871 307.192 392.196C308.049 392.932 308.955 393.621 309.851 394.318C309.993 394.427 310.197 394.468 310.373 394.541C310.31 394.365 310.29 394.163 310.177 394.02C309.476 393.127 308.694 392.283 308.049 391.357C306.623 389.314 305.239 387.244 303.878 385.163C302.011 382.307 300.075 379.481 298.366 376.548C296.553 373.439 294.751 370.292 294.122 366.701ZM348.095 354.988C349.243 354.789 350.326 355.058 351.394 355.388C354.455 356.332 356.629 358.241 358.109 360.791C359.162 362.602 359.633 364.581 359.488 366.656C359.477 366.822 359.591 366.993 359.647 367.163C359.761 366.99 359.962 366.822 359.971 366.644C360.051 365.102 360.171 363.557 360.128 362.017C360.099 361.025 359.907 360.018 359.631 359.056C358.642 355.584 355.638 353.62 351.744 353.779C350.454 353.833 349.174 354.15 347.898 354.382C347.534 354.448 347.195 354.639 346.846 354.772C347.206 354.844 347.566 354.917 348.095 354.988ZM326.505 408.774C326.35 408.683 326.203 408.571 326.036 408.506C325.811 408.419 325.568 408.37 325.334 408.304C325.451 408.467 325.537 408.659 325.688 408.79C327.442 410.302 329.199 411.815 330.981 413.302C331.134 413.428 331.534 413.469 331.704 413.376C332.032 413.198 332.329 412.925 332.534 412.631C332.625 412.501 332.535 412.105 332.395 412.028C330.473 410.948 328.528 409.904 326.505 408.774Z"
                    fill="#EC615B"
                />
            </g>
        </g>
    </g>
</template>

<script>
export default {
    data: () => ({
        conditionChartColor: [
            "#FF5757", // great
            "#FFC8C8", // good
            "#D9D9D9", // normal
            "#9B97FF", // bad
            "#4B4989", // worse
        ],
        feelingChartColor: {
            anxious: "#6666CC",
            hard: "#6B6C99",
            tired: "#63ADF7",
            sad: "#B3DAFF",
            angry: "#C30D34",
            kuyashi: "#AD63F7",
            lethargic: "#899AAB",
            moyamoya: "#8989AB",
            glad: "#F7F763",
            fun: "#F7AD63",
            calm: "#52CC8F",
            happy: "#FFB3B4",
            wakuwaku: "#F763AD",
        },
        conditionPieCharts: [],
        conditionStrokeDasharrayLimit: 880,
        feelingPieCharts: [],
        feelingStrokeDasharrayLimit: 566,
        first: true,
    }),
    props: {
        conditions: {
            type: Array,
        },
        feelings: {
            type: Array,
        },
    },
    computed: {},
    methods: {
        createConditionStrokeDasharray(conditions) {
            let lineTotalUpToNow = 0;
            const conditionPieChart = [];
            for (let i = 0; i < conditions.type.length; i++) {
                const conditionPercent =
                    this.conditionStrokeDasharrayLimit *
                    (conditions.type[i].num / conditions.total);
                if (conditions.type[i].num > 0) {
                    if (i === 0) {
                        conditionPieChart.push({
                            color: this.conditionChartColor[i],
                            strokeDashArray:
                                conditionPercent +
                                " " +
                                (this.conditionStrokeDasharrayLimit -
                                    conditionPercent),
                        });
                    } else {
                        conditionPieChart.push({
                            color: this.conditionChartColor[i],
                            strokeDashArray:
                                "0" +
                                " " +
                                lineTotalUpToNow +
                                " " +
                                conditionPercent +
                                " " +
                                (this.conditionStrokeDasharrayLimit -
                                    (lineTotalUpToNow + conditionPercent)),
                        });
                    }
                }
                lineTotalUpToNow += conditionPercent;
            }
            console.info(conditionPieChart);
            return conditionPieChart;
        },
        createFeelingStorkeDasharray(feelings) {
            let lineTotalUpToNow = 0;
            const feelingPieChart = [];
            for (const feelingName in feelings.type) {
                const feelingPercent =
                    this.feelingStrokeDasharrayLimit *
                    (feelings.type[feelingName] / feelings.total);

                if (this.first) {
                    feelingPieChart.push({
                        color: this.feelingChartColor[feelingName],
                        strokeDashArray:
                            feelingPercent +
                            " " +
                            (this.feelingStrokeDasharrayLimit - feelingPercent),
                    });
                    this.first = false;
                } else {
                    feelingPieChart.push({
                        color: this.feelingChartColor[feelingName],
                        strokeDashArray:
                            "0" +
                            " " +
                            lineTotalUpToNow +
                            " " +
                            feelingPercent +
                            " " +
                            (this.feelingStrokeDasharrayLimit -
                                (feelingPercent + lineTotalUpToNow)),
                    });
                }
                lineTotalUpToNow += feelingPercent;
            }
            return feelingPieChart;
        },
    },
    async mounted() {
        const conditionChartArray = [];
        const feelingChartArray = [];

        for (const key in this.conditions) {
            conditionChartArray[key] = this.createConditionStrokeDasharray(
                this.conditions[key]
            );
            feelingChartArray[key] = this.createFeelingStorkeDasharray(
                this.feelings[key]
            );
        }
        this.conditionPieCharts = conditionChartArray;
        this.feelingPieCharts = feelingChartArray;
    },
};
</script>
