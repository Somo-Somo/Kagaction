<template>
    <div class="hello">
        <svg
            ref="svgCard"
            width="1200"
            height="800"
            viewBox="0 0 1200 800"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
        >
            <g id="Weekly Report ">
                <rect
                    id="Report Image"
                    width="1200"
                    height="800"
                    fill="white"
                />
                <PieChart :condition="condition" :feeling="feeling" />
                <g id="Service Name">
                    <path
                        id="#Agathon"
                        d="M69.2403 752H73.3203L74.3603 743.56H78.8803L77.8803 752H82.0003L83.0003 743.56H87.4003V739.04H83.5203L84.1603 734.2H88.3203V729.68H84.7203L85.6003 722.24H81.5203L80.6003 729.68H76.0403L76.9203 722.24H72.8803L71.9603 729.68H67.8003V734.2H71.3603L70.7603 739.04H66.8803V743.56H70.2403L69.2403 752ZM74.8403 739.04L75.4403 734.2H80.0003L79.4003 739.04H74.8403ZM89.3753 752H96.6553L100.375 737.12C101.135 734.16 101.935 730.68 102.655 727.56H102.815C103.615 730.6 104.375 734.16 105.175 737.12L108.895 752H116.415L107.175 722.2H98.6153L89.3753 752ZM95.6553 745.16H110.055V739.64H95.6553V745.16ZM127.142 761.56C135.062 761.56 140.062 758.16 140.062 753.36C140.062 749.24 136.862 747.52 131.262 747.52H127.662C125.222 747.52 124.302 747.04 124.302 746C124.302 745.2 124.542 744.88 125.022 744.4C126.022 744.68 126.942 744.8 127.702 744.8C132.742 744.8 136.782 742.48 136.782 737.16C136.782 736.08 136.502 735.04 136.182 734.4H139.662V729.24H131.302C130.262 728.88 129.022 728.68 127.702 728.68C122.782 728.68 118.182 731.4 118.182 736.92C118.182 739.6 119.662 741.72 121.302 742.84V743C119.782 744.04 118.742 745.64 118.742 747.24C118.742 749.16 119.622 750.36 120.822 751.16V751.36C118.702 752.44 117.622 753.96 117.622 755.84C117.622 759.92 121.902 761.56 127.142 761.56ZM127.702 740.52C126.062 740.52 124.822 739.32 124.822 736.92C124.822 734.64 126.062 733.44 127.702 733.44C129.382 733.44 130.622 734.64 130.622 736.92C130.622 739.32 129.382 740.52 127.702 740.52ZM128.262 757.12C125.382 757.12 123.462 756.32 123.462 754.72C123.462 753.96 123.782 753.32 124.502 752.68C125.222 752.88 126.102 752.96 127.742 752.96H129.902C132.022 752.96 133.222 753.24 133.222 754.6C133.222 756.04 131.182 757.12 128.262 757.12ZM148.257 752.56C150.777 752.56 152.897 751.4 154.777 749.72H154.977L155.457 752H161.257V739.08C161.257 731.96 157.937 728.68 152.057 728.68C148.497 728.68 145.257 729.88 142.257 731.68L144.737 736.36C147.017 735.08 148.897 734.36 150.697 734.36C153.017 734.36 153.977 735.44 154.137 737.28C145.257 738.24 141.497 740.84 141.497 745.64C141.497 749.44 144.057 752.56 148.257 752.56ZM150.697 747.04C149.217 747.04 148.257 746.4 148.257 745.08C148.257 743.48 149.697 742.16 154.137 741.6V745.24C153.097 746.36 152.137 747.04 150.697 747.04ZM174.582 752.56C176.902 752.56 178.542 752.08 179.742 751.72L178.622 746.56C178.062 746.76 177.262 747 176.542 747C174.862 747 173.662 746 173.662 743.48V734.8H179.022V729.24H173.662V723.2H167.782L166.982 729.24L163.462 729.52V734.8H166.542V743.56C166.542 748.92 168.862 752.56 174.582 752.56ZM183.435 752H190.555V736.8C191.915 735.48 192.875 734.76 194.475 734.76C196.275 734.76 197.115 735.64 197.115 738.8V752H204.235V737.92C204.235 732.24 202.115 728.68 197.155 728.68C194.075 728.68 191.835 730.24 190.195 731.76L190.555 727.72V720.04H183.435V752ZM219.643 752.56C225.403 752.56 230.763 748.16 230.763 740.6C230.763 733.08 225.403 728.68 219.643 728.68C213.843 728.68 208.483 733.08 208.483 740.6C208.483 748.16 213.843 752.56 219.643 752.56ZM219.643 746.8C216.963 746.8 215.763 744.4 215.763 740.6C215.763 736.84 216.963 734.44 219.643 734.44C222.283 734.44 223.483 736.84 223.483 740.6C223.483 744.4 222.283 746.8 219.643 746.8ZM235.232 752H242.352V736.8C243.712 735.48 244.672 734.76 246.272 734.76C248.072 734.76 248.912 735.64 248.912 738.8V752H256.032V737.92C256.032 732.24 253.912 728.68 248.952 728.68C245.872 728.68 243.552 730.24 241.672 732.08H241.552L241.032 729.24H235.232V752Z"
                        fill="#000F99"
                    />
                </g>
                <g id="Date">
                    <path
                        id="2022-12-12 ~2022-12-19"
                        d="M788.707 750H803.155V745.8H799.347C798.395 745.8 796.967 745.94 795.931 746.08C799.123 742.86 802.203 738.912 802.203 735.328C802.203 731.352 799.403 728.776 795.371 728.776C792.403 728.776 790.499 729.812 788.455 731.996L791.171 734.684C792.179 733.62 793.271 732.668 794.699 732.668C796.379 732.668 797.415 733.704 797.415 735.608C797.415 738.632 793.915 742.412 788.707 747.144V750ZM813.134 750.392C817.53 750.392 820.498 746.64 820.498 739.472C820.498 732.332 817.53 728.776 813.134 728.776C808.738 728.776 805.742 732.304 805.742 739.472C805.742 746.64 808.738 750.392 813.134 750.392ZM813.134 746.528C811.65 746.528 810.446 745.184 810.446 739.472C810.446 733.788 811.65 732.584 813.134 732.584C814.618 732.584 815.794 733.788 815.794 739.472C815.794 745.184 814.618 746.528 813.134 746.528ZM822.832 750H837.28V745.8H833.472C832.52 745.8 831.092 745.94 830.056 746.08C833.248 742.86 836.328 738.912 836.328 735.328C836.328 731.352 833.528 728.776 829.496 728.776C826.528 728.776 824.624 729.812 822.58 731.996L825.296 734.684C826.304 733.62 827.396 732.668 828.824 732.668C830.504 732.668 831.54 733.704 831.54 735.608C831.54 738.632 828.04 742.412 822.832 747.144V750ZM839.895 750H854.343V745.8H850.535C849.583 745.8 848.155 745.94 847.119 746.08C850.311 742.86 853.391 738.912 853.391 735.328C853.391 731.352 850.591 728.776 846.559 728.776C843.591 728.776 841.687 729.812 839.643 731.996L842.359 734.684C843.367 733.62 844.459 732.668 845.887 732.668C847.567 732.668 848.603 733.704 848.603 735.608C848.603 738.632 845.103 742.412 839.895 747.144V750ZM857.181 743.644H865.105V740.144H857.181V743.644ZM868.684 750H881.844V745.968H878.092V729.14H874.424C872.968 730.064 871.512 730.624 869.272 731.044V734.124H873.108V745.968H868.684V750ZM884.739 750H899.187V745.8H895.379C894.427 745.8 892.999 745.94 891.963 746.08C895.155 742.86 898.235 738.912 898.235 735.328C898.235 731.352 895.435 728.776 891.403 728.776C888.435 728.776 886.531 729.812 884.486 731.996L887.203 734.684C888.211 733.62 889.303 732.668 890.731 732.668C892.411 732.668 893.447 733.704 893.447 735.608C893.447 738.632 889.947 742.412 884.739 747.144V750ZM902.025 743.644H909.949V740.144H902.025V743.644ZM913.528 750H926.688V745.968H922.936V729.14H919.268C917.812 730.064 916.356 730.624 914.116 731.044V734.124H917.952V745.968H913.528V750ZM929.582 750H944.03V745.8H940.222C939.27 745.8 937.842 745.94 936.806 746.08C939.998 742.86 943.078 738.912 943.078 735.328C943.078 731.352 940.278 728.776 936.246 728.776C933.278 728.776 931.374 729.812 929.33 731.996L932.046 734.684C933.054 733.62 934.146 732.668 935.574 732.668C937.254 732.668 938.29 733.704 938.29 735.608C938.29 738.632 934.79 742.412 929.582 747.144V750ZM963.095 742.384C964.719 742.384 966.399 741.488 968.023 739.024L965.447 737.036C964.803 738.184 964.019 738.856 963.151 738.856C961.415 738.856 960.351 736.476 957.691 736.476C956.067 736.476 954.387 737.372 952.763 739.836L955.339 741.796C955.983 740.676 956.767 739.976 957.635 739.976C959.371 739.976 960.463 742.384 963.095 742.384ZM970.106 750H984.554V745.8H980.746C979.794 745.8 978.366 745.94 977.33 746.08C980.522 742.86 983.602 738.912 983.602 735.328C983.602 731.352 980.802 728.776 976.77 728.776C973.802 728.776 971.898 729.812 969.854 731.996L972.57 734.684C973.578 733.62 974.67 732.668 976.098 732.668C977.778 732.668 978.814 733.704 978.814 735.608C978.814 738.632 975.314 742.412 970.106 747.144V750ZM994.532 750.392C998.928 750.392 1001.9 746.64 1001.9 739.472C1001.9 732.332 998.928 728.776 994.532 728.776C990.136 728.776 987.14 732.304 987.14 739.472C987.14 746.64 990.136 750.392 994.532 750.392ZM994.532 746.528C993.048 746.528 991.844 745.184 991.844 739.472C991.844 733.788 993.048 732.584 994.532 732.584C996.016 732.584 997.192 733.788 997.192 739.472C997.192 745.184 996.016 746.528 994.532 746.528ZM1004.23 750H1018.68V745.8H1014.87C1013.92 745.8 1012.49 745.94 1011.45 746.08C1014.65 742.86 1017.73 738.912 1017.73 735.328C1017.73 731.352 1014.93 728.776 1010.89 728.776C1007.93 728.776 1006.02 729.812 1003.98 731.996L1006.69 734.684C1007.7 733.62 1008.79 732.668 1010.22 732.668C1011.9 732.668 1012.94 733.704 1012.94 735.608C1012.94 738.632 1009.44 742.412 1004.23 747.144V750ZM1021.29 750H1035.74V745.8H1031.93C1030.98 745.8 1029.55 745.94 1028.52 746.08C1031.71 742.86 1034.79 738.912 1034.79 735.328C1034.79 731.352 1031.99 728.776 1027.96 728.776C1024.99 728.776 1023.09 729.812 1021.04 731.996L1023.76 734.684C1024.77 733.62 1025.86 732.668 1027.29 732.668C1028.97 732.668 1030 733.704 1030 735.608C1030 738.632 1026.5 742.412 1021.29 747.144V750ZM1038.58 743.644H1046.5V740.144H1038.58V743.644ZM1050.08 750H1063.24V745.968H1059.49V729.14H1055.82C1054.37 730.064 1052.91 730.624 1050.67 731.044V734.124H1054.51V745.968H1050.08V750ZM1066.14 750H1080.58V745.8H1076.78C1075.82 745.8 1074.4 745.94 1073.36 746.08C1076.55 742.86 1079.63 738.912 1079.63 735.328C1079.63 731.352 1076.83 728.776 1072.8 728.776C1069.83 728.776 1067.93 729.812 1065.88 731.996L1068.6 734.684C1069.61 733.62 1070.7 732.668 1072.13 732.668C1073.81 732.668 1074.84 733.704 1074.84 735.608C1074.84 738.632 1071.34 742.412 1066.14 747.144V750ZM1083.42 743.644H1091.35V740.144H1083.42V743.644ZM1094.93 750H1108.09V745.968H1104.33V729.14H1100.67C1099.21 730.064 1097.75 730.624 1095.51 731.044V734.124H1099.35V745.968H1094.93V750ZM1117.28 750.392C1121.54 750.392 1125.51 746.892 1125.51 739.332C1125.51 731.772 1121.68 728.776 1117.73 728.776C1114 728.776 1110.87 731.408 1110.87 735.832C1110.87 740.312 1113.47 742.384 1116.97 742.384C1118.26 742.384 1120.16 741.516 1121.17 740.032L1120.92 736.812C1120.11 738.324 1118.96 738.884 1117.92 738.884C1116.52 738.884 1115.4 738.072 1115.4 735.832C1115.4 733.424 1116.52 732.5 1117.84 732.5C1119.38 732.5 1120.98 733.9 1120.98 739.332C1120.98 744.624 1119.21 746.36 1116.94 746.36C1115.77 746.36 1114.48 745.688 1113.78 744.904L1111.15 747.9C1112.46 749.216 1114.48 750.392 1117.28 750.392Z"
                        fill="black"
                    />
                </g>
                <ConditionRank :condition="condition" />
                <FeelingRank :feeling="feeling" />
            </g>
            <defs>
                <clipPath id="clip0_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 447)"
                    />
                </clipPath>
                <clipPath id="clip1_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(966 447)"
                    />
                </clipPath>
                <clipPath id="clip2_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 531)"
                    />
                </clipPath>
                <clipPath id="clip3_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(966 531)"
                    />
                </clipPath>
                <clipPath id="clip4_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 615)"
                    />
                </clipPath>
                <clipPath id="clip5_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 133)"
                    />
                </clipPath>
                <clipPath id="clip6_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(966 133)"
                    />
                </clipPath>
                <clipPath id="clip7_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 217)"
                    />
                </clipPath>
                <clipPath id="clip8_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(966 217)"
                    />
                </clipPath>
                <clipPath id="clip9_140_4">
                    <rect
                        width="56"
                        height="56"
                        fill="white"
                        transform="translate(742 301)"
                    />
                </clipPath>
            </defs>
        </svg>
        <button>出力</button>
        <div id="result"><img :src="dataURL" /></div>
    </div>
</template>

<script>
import PieChart from "./Views/Report/Template/PieChart.vue";
import ConditionRank from "./Views/Report/Template/ConditionRank.vue";
import FeelingRank from "./Views/Report/Template/FeelingRank.vue";
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import {
    getStorage,
    ref,
    uploadString,
    getDownloadURL,
} from "firebase/storage";
import { v4 as uuidv4 } from "uuid";

// const config = {
//     apiKey: propcess.env.FIREBASE_API_KEY,
//     authDomain: propcess.env.FIREBASE_AUTH_DOMAIN,
//     projectId: propcess.env.FIREBASE_PROJECT_ID,
//     storageBucket: propcess.env.FIREBASE_STORAGE_BUCKET,
//     messagingSenderId: propcess.env.FIREBASE_MESSAGING_SENDER_ID,
//     appId: propcess.env.FIREBASE_APP_ID,
//     measurementId: propcess.env.FIREBASE_MEASUREMENT_ID,
// };

const firebaseConfig = {
    apiKey: "AIzaSyCWFF-fxzg4yBMO7nc51V_y73XscSMY7ZY",
    authDomain: "agathon-2022-12.firebaseapp.com",
    projectId: "agathon-2022-12",
    storageBucket: "agathon-2022-12.appspot.com",
    messagingSenderId: "715234137429",
    appId: "1:715234137429:web:a0c46e601550795fd24bdc",
    measurementId: "G-8MJG0PWKYM",
};

// Initialize Firebase
const firebase = initializeApp(firebaseConfig);
const firestorage = getStorage(firebase);

function svg2imageData(svgElement, successCallback, errorCallback) {
    var canvas = document.createElement("canvas");
    canvas.width = svgElement.width.baseVal.value;
    canvas.height = svgElement.height.baseVal.value;
    var ctx = canvas.getContext("2d");
    var image = new Image();
    image.onload = () => {
        ctx.drawImage(image, 0, 0, image.width, image.height);
        successCallback(canvas.toDataURL());
    };
    image.onerror = (e) => {
        errorCallback(e);
    };
    var svgData = new XMLSerializer().serializeToString(svgElement);
    image.src =
        "data:image/svg+xml;charset=utf-8;base64," +
        btoa(unescape(encodeURIComponent(svgData)));
}

export default {
    components: {
        PieChart,
        ConditionRank,
        FeelingRank,
    },
    data() {
        return {
            id: null,
            error: null,
            dataURL: null,
            condition: {
                total: 15,
                type: [
                    { name: "絶好調", num: 2 },
                    { name: "順調", num: 3 },
                    { name: "普通", num: 4 },
                    { name: "不調", num: 3 },
                    { name: "絶不調", num: 3 },
                ],
            },
            feeling: {
                total: 14,
                type: [
                    {
                        name: "happy",
                        num: 2,
                        color: "#FF8C00",
                    },
                    {
                        name: "glad",
                        num: 1,
                        color: "#FCC801",
                    },
                    {
                        name: "wakuwaku",
                        num: 2,
                        color: "#439679",
                    },
                    {
                        name: "anxious",
                        num: 5,
                        color: "#5891AD",
                    },
                    {
                        name: "kuyashi",
                        num: 1,
                        color: "#2291AD",
                    },
                    {
                        name: "moyamoya",
                        num: 1,
                        color: "#2291AD",
                    },
                    {
                        name: "lethargic",
                        num: 1,
                        color: "#2291AD",
                    },
                    {
                        name: "tired",
                        num: 1,
                        color: "#2291AD",
                    },
                ],
            },
        };
    },
    props: {
        data: {
            type: Array,
        },
    },
    computed: {},
    methods: {},
    created() {},
    async mounted() {
        axios
            .get("/api/report/monthly/1")
            .then((res) => {
                console.info(getStorage);
                this.id = res.data.id;
                this.dataURL = svg2imageData(this.$refs.svgCard, (data) => {
                    this.dataURL = data;
                    const uuid = uuidv4();
                    console.info(data);
                    const storageRef = ref(
                        firestorage,
                        "users/" + this.id + "/images/" + uuid + ".png"
                    );
                    console.info(storageRef);
                    uploadString(storageRef, data, "data_url").then(() => {
                        console.log("Uploaded a file!");
                        getDownloadURL(storageRef)
                            .then((url) => {
                                console.log(url);
                            })
                            .catch((err) => console.log(err));
                    });
                });
            })
            .catch((err) => {
                this.error = err;
                console.log(err);
            });
    },
};
</script>
